# 嵌入式软硬件协同开发规范与工作流程（迭代周期指南）

> ⚠：本规范需要等到实际开发中的第一次会议进一步明确，请等待更新~

[TOC]

## 1. 协作目标
为保证软硬件协同开发高效、可追踪、可复现，建立规范的分工方式、沟通机制与迭代流程，使每一轮迭代都有清晰交付物并可进行实机验证。

---

## 2. 分工职责
### 2.1 软件开发（你）
- 负责嵌入式系统的软件架构、驱动、业务逻辑与应用功能实现。
- 保证代码分层清晰：**HAL 驱动层 → 底层库/平台层 → 业务逻辑层 → 应用接口层**。
- 负责编写单元测试、集成测试，以及基于实机的功能验证。
- 保持仓库结构清晰、可复用，遵守编码规范和提交规范。

### 2.2 硬件开发（同事）
- 负责电路设计、模组选型、PCB 制作与调试。
- 输出硬件接口文档、时序、寄存器/驱动需求说明。
- 迭代中固定输出**不超过 100 字的小报告**：包含本轮硬件变更点、接口影响与测试注意事项。

---

## 3. Git 协作约定
### 3.1 分支模型（推荐 Git Flow 简化版）
- **main**：稳定可发布版本（对应每轮迭代完成的固件）。
- **develop**：当前开发版本。
- **feature/**：每个功能独立分支，如 `feature/uart_driver`、`feature/lcd_render`。
- **hotfix/**：紧急修复分支。

### 3.2 提交规范
- 使用语义化提交（可选 Conventional Commits）：
  - `feat:` 新功能
  - `fix:` 修复 Bug
  - `refactor:` 重构
  - `test:` 补充测试
  - `docs:` 文档
- 每个提交包含：**目的 + 关键修改点**。

### 3.3 代码审查
- feature 分支合入 develop 前必须发起 MR/PR。
- 软件维护方负责软件审查，硬件同事仅需确认接口不冲突。

---

## 4. 软件架构与分层规范
### 4.1 目录规范
```
/firmware
  /hal              # HAL 驱动（GPIO/UART/SPI/I2C/...）
  /driver           # 基于 HAL 的设备驱动（LCD/Sensor/Flash）
  /middleware       # 通用库（GUI、协议栈）
  /core             # OS、任务调度、系统初始化
  /app              # 业务逻辑与应用
  /tests            # 单元/集成测试
  /board            # 针对特定硬件的配置文件
```

### 4.2 分层约束
- app 只能调用 middleware/driver 层接口。
- driver 仅依赖 hal。
- hal 只操作寄存器/外设，禁止业务逻辑。
- 若硬件改动，只应影响 board + hal，不应影响 app 层。

---

## 5. 硬件协作规范
### 5.1 硬件文档清单（每轮迭代提供）
- 原理图变更点（如模块替换、引脚调整）。
- 接口定义（如 UART2 → UART3，LCD SPI 速率变更）。
- 电源/时钟/复位信息。
- 关键芯片/外设 datasheet 链接。

### 5.2 硬件小报告格式（不超过 100 字）
示例：
> 本轮将温度传感器由 A 芯片换为 B，I2C 地址变为 0x48；LCD 背光电路新增 PWM 控制，请使用 TIM3-CH2 输出占空比；其他电路无改动，可按上一版固件测试。

---

## 6. 周期性迭代流程（建议 2 周一轮）
### 阶段 1：需求 & 规划（0.5 天）
- 明确本轮目标（功能/驱动/硬件修订）。
- 评估是否需要硬件改板或飞线。
- 输出：**《迭代计划》**。

### 阶段 2：硬件准备（1-3 天）
- 硬件同事完成电路修改、焊接、飞线或小批次 PCB。
- 输出：**硬件小报告**。

### 阶段 3：软件开发（3-7 天）
- 在模拟器/板级 HAL 下完成功能开发。
- 先写单元测试，再实现驱动。
- 持续推送到 feature 分支。

### 阶段 4：联调（2-3 天）
- 软硬件在实机上联调。
- 记录问题、调试日志并修复。
- 输出：**系统联调记录**。

### 阶段 5：回归测试与固件发布（1 天）
- 测试 SOP（如启动、功能、功耗、稳定性）。
- 固件版本号更新 → 编译 → 打包。
- 合入 main 分支并打 tag。
- 输出：**Release Note**（更新点 + 已知问题）。

---

## 7. 常用协作产物模板
### 7.1 《迭代计划》模板
- 本轮目标：
- 软件任务：
- 硬件任务：
- 风险与依赖：
- 预计耗时：

### 7.2 《系统联调记录》模板
- 时间：
- 硬件版本：
- 固件版本：
- 测试内容：
- 结果：
- 问题 & 改进建议：

### 7.3 《Release Note》模板
- 版本号：
- 发布日期：
- 主要更新：
- 修复问题：
- 已知问题：

---

## 8. 总结
此流程保证：
1. 软件分层清晰，可复用、可维护。
2. 硬件变更透明、可追踪。
3. 每轮迭代均具备**可发布固件 + 实机验证**。
4. 整体开发节奏规律透明，适用于 2 人或小团队协作。

